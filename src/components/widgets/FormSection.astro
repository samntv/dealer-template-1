---
interface FormField {
  id: string;
  name: string;
  label: string;
  type:
    | "text"
    | "email"
    | "tel"
    | "number"
    | "textarea"
    | "select"
    | "checkbox"
    | "radio";
  placeholder?: string;
  required?: boolean;
  options?: string[]; // For select, radio
  rows?: number; // For textarea
  pattern?: string;
  helpText?: string;
  width?: "full" | "half"; // Layout width
}

interface Props {
  title?: string;
  subtitle?: string;
  description?: string;
  fields: FormField[];
  submitText?: string;
  submitAction?: string;
  method?: "POST" | "GET";
  successMessage?: string;
  background?: string;
}

const {
  title = "Get In Touch",
  subtitle = "We'd love to hear from you",
  description = "Fill out the form below and we'll get back to you as soon as possible.",
  fields = [],
  submitText = "Submit",
  submitAction = "/api/contact",
  method = "POST",
  successMessage = "Thank you! We'll be in touch soon.",
  background = "white",
} = Astro.props;

const bgClass =
  background === "primary-dark" ? "bg-primary-dark text-white" : "bg-white";
---

<section class={`py-20 ${bgClass}`}>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    {
      (title || subtitle || description) && (
        <div class="text-center mb-12">
          {subtitle && (
            <p class="text-sm font-semibold text-primary uppercase tracking-wider mb-2">
              {subtitle}
            </p>
          )}
          {title && (
            <h2 class="text-3xl md:text-4xl font-bold mb-4">{title}</h2>
          )}
          {description && (
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">{description}</p>
          )}
        </div>
      )
    }

    <!-- Form -->
    <form
      action={submitAction}
      method={method}
      class="space-y-6"
      id="contact-form"
    >
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {
          fields.map((field) => {
            const widthClass =
              field.width === "full" ? "md:col-span-2" : "md:col-span-1";

            return (
              <div class={widthClass}>
                {/* Label */}
                {field.label && field.type !== "checkbox" && (
                  <label
                    for={field.id}
                    class="block text-sm font-medium text-gray-700 mb-2"
                  >
                    {field.label}
                    {field.required && <span class="text-red-500 ml-1">*</span>}
                  </label>
                )}

                {/* Text Input */}
                {(field.type === "text" ||
                  field.type === "email" ||
                  field.type === "tel" ||
                  field.type === "number") && (
                  <input
                    type={field.type}
                    id={field.id}
                    name={field.name}
                    placeholder={field.placeholder}
                    required={field.required}
                    pattern={field.pattern}
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                  />
                )}

                {/* Textarea */}
                {field.type === "textarea" && (
                  <textarea
                    id={field.id}
                    name={field.name}
                    placeholder={field.placeholder}
                    required={field.required}
                    rows={field.rows || 4}
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition resize-none"
                  />
                )}

                {/* Select */}
                {field.type === "select" && field.options && (
                  <select
                    id={field.id}
                    name={field.name}
                    required={field.required}
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent transition"
                  >
                    <option value="">Select an option</option>
                    {field.options.map((option) => (
                      <option value={option}>{option}</option>
                    ))}
                  </select>
                )}

                {/* Checkbox */}
                {field.type === "checkbox" && (
                  <div class="flex items-start">
                    <input
                      type="checkbox"
                      id={field.id}
                      name={field.name}
                      required={field.required}
                      class="mt-1 h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"
                    />
                    <label for={field.id} class="ml-2 text-sm text-gray-700">
                      {field.label}
                      {field.required && (
                        <span class="text-red-500 ml-1">*</span>
                      )}
                    </label>
                  </div>
                )}

                {/* Radio */}
                {field.type === "radio" && field.options && (
                  <div class="space-y-2">
                    {field.options.map((option, idx) => (
                      <div class="flex items-center">
                        <input
                          type="radio"
                          id={`${field.id}-${idx}`}
                          name={field.name}
                          value={option}
                          required={field.required}
                          class="h-4 w-4 text-primary border-gray-300 focus:ring-primary"
                        />
                        <label
                          for={`${field.id}-${idx}`}
                          class="ml-2 text-sm text-gray-700"
                        >
                          {option}
                        </label>
                      </div>
                    ))}
                  </div>
                )}

                {/* Help Text */}
                {field.helpText && (
                  <p class="mt-1 text-sm text-gray-500">{field.helpText}</p>
                )}
              </div>
            );
          })
        }
      </div>

      <!-- Submit Button -->
      <div class="text-center pt-4">
        <button
          type="submit"
          class="px-8 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary-dark transition-all transform hover:scale-105"
        >
          {submitText}
        </button>
      </div>

      <!-- Success Message (hidden by default) -->
      <div
        id="success-message"
        class="hidden p-4 bg-green-50 border border-green-200 rounded-lg text-green-800 text-center"
      >
        {successMessage}
      </div>
    </form>
  </div>
</section>

<script>
  function initForm() {
    const form = document.getElementById("contact-form") as HTMLFormElement;
    const successMessage = document.getElementById("success-message");

    if (form) {
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new FormData(form);
        const data = Object.fromEntries(formData);

        try {
          // You can replace this with your actual form submission logic
          console.log("Form data:", data);

          // Simulate API call
          await new Promise((resolve) => setTimeout(resolve, 1000));

          // Show success message
          form.classList.add("hidden");
          successMessage?.classList.remove("hidden");

          // Reset form after 3 seconds
          setTimeout(() => {
            form.reset();
            form.classList.remove("hidden");
            successMessage?.classList.add("hidden");
          }, 3000);
        } catch (error) {
          console.error("Form submission error:", error);
          alert("There was an error submitting the form. Please try again.");
        }
      });
    }
  }

  initForm();
  document.addEventListener("astro:after-swap", initForm);
</script>
