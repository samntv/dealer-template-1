---
interface Brand {
  name: string;
  logo: string;
}

interface Props {
  title?: string;
  subtitle?: string;
  brands: Brand[];
  itemsPerView?: number; // How many logos to show at once
  autoplay?: boolean;
  speed?: number; // Animation speed in seconds
}

const {
  title,
  subtitle,
  brands,
  itemsPerView = 4,
  autoplay = true,
  speed = 30,
} = Astro.props;

const sliderId = `slider-${Math.random().toString(36).substr(2, 9)}`;
---

<div class="logo-slider-container py-8">
  {
    (title || subtitle) && (
      <div class="text-center mb-8">
        {title && (
          <h3 class="text-2xl font-bold text-gray-900 mb-2 uppercase tracking-wider">
            {title}
          </h3>
        )}
        {subtitle && <p class="text-sm text-gray-600">{subtitle}</p>}
      </div>
    )
  }

  <div class="relative max-w-6xl mx-auto px-12">
    <!-- Previous Button -->
    <button
      class="slider-prev absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-white rounded-full shadow-lg hover:bg-gray-50 transition-all flex items-center justify-center"
      data-slider={sliderId}
    >
      <svg
        class="w-5 h-5 text-gray-700"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>

    <!-- Slider Track -->
    <div class="overflow-hidden">
      <div
        class="slider-track flex transition-transform duration-500 ease-in-out"
        id={sliderId}
        data-items={itemsPerView}
        data-autoplay={autoplay}
        data-speed={speed}
      >
        {
          brands.map((brand) => (
            <div
              class="slider-item flex-shrink-0 px-4 flex items-center justify-center"
              style={`width: ${100 / itemsPerView}%`}
            >
              <div class="transition-transform duration-300 hover:scale-110">
                <img
                  src={brand.logo}
                  alt={brand.name}
                  class="h-16 w-auto object-contain mx-auto"
                  loading="lazy"
                />
              </div>
            </div>
          ))
        }
      </div>
    </div>

    <!-- Next Button -->
    <button
      class="slider-next absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-white rounded-full shadow-lg hover:bg-gray-50 transition-all flex items-center justify-center"
      data-slider={sliderId}
    >
      <svg
        class="w-5 h-5 text-gray-700"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>

  <!-- Dots Indicator -->
  <div class="flex justify-center gap-2 mt-6" id={`${sliderId}-dots`}>
    <!-- Dots will be generated by JavaScript -->
  </div>
</div>

<script>
  function initSliders() {
    document.querySelectorAll(".slider-track").forEach((track) => {
      const trackEl = track as HTMLElement;
      const sliderId = trackEl.id;
      const itemsPerView = parseInt(trackEl.dataset.items || "4");
      const autoplay = trackEl.dataset.autoplay === "true";
      const speed = parseInt(trackEl.dataset.speed || "30") * 1000;

      const items = track.querySelectorAll(".slider-item");
      const totalItems = items.length;
      const totalSlides = Math.ceil(totalItems / itemsPerView);
      let currentSlide = 0;
      let autoplayInterval: number | null = null;

      // Create dots
      const dotsContainer = document.getElementById(`${sliderId}-dots`);
      if (dotsContainer && totalSlides > 1) {
        for (let i = 0; i < totalSlides; i++) {
          const dot = document.createElement("button");
          dot.className = `w-2 h-2 rounded-full transition-all ${i === 0 ? "bg-primary w-6" : "bg-gray-300"}`;
          dot.dataset.slide = i.toString();
          dot.addEventListener("click", () => goToSlide(i));
          dotsContainer.appendChild(dot);
        }
      }

      function updateDots() {
        const dots = dotsContainer?.querySelectorAll("button");
        dots?.forEach((dot, index) => {
          if (index === currentSlide) {
            dot.className = "w-6 h-2 rounded-full transition-all bg-primary";
          } else {
            dot.className = "w-2 h-2 rounded-full transition-all bg-gray-300";
          }
        });
      }

      function goToSlide(index: number) {
        currentSlide = index;
        const offset = -(currentSlide * 100);
        (track as HTMLElement).style.transform = `translateX(${offset}%)`;
        updateDots();
        resetAutoplay();
      }

      function nextSlide() {
        currentSlide = (currentSlide + 1) % totalSlides;
        goToSlide(currentSlide);
      }

      function prevSlide() {
        currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
        goToSlide(currentSlide);
      }

      function resetAutoplay() {
        if (autoplay) {
          if (autoplayInterval) clearInterval(autoplayInterval);
          autoplayInterval = window.setInterval(nextSlide, speed);
        }
      }

      // Navigation buttons
      const prevBtn = document.querySelector(
        `.slider-prev[data-slider="${sliderId}"]`
      );
      const nextBtn = document.querySelector(
        `.slider-next[data-slider="${sliderId}"]`
      );

      prevBtn?.addEventListener("click", prevSlide);
      nextBtn?.addEventListener("click", nextSlide);

      // Start autoplay
      if (autoplay && totalSlides > 1) {
        resetAutoplay();
      }

      // Pause on hover
      track.addEventListener("mouseenter", () => {
        if (autoplayInterval) clearInterval(autoplayInterval);
      });

      track.addEventListener("mouseleave", resetAutoplay);
    });
  }

  initSliders();
  document.addEventListener("astro:after-swap", initSliders);
</script>

<style>
  .logo-slider-container {
    position: relative;
  }

  @media (max-width: 768px) {
    .slider-item {
      width: 50% !important;
    }
  }

  @media (max-width: 480px) {
    .slider-item {
      width: 100% !important;
    }
  }
</style>
