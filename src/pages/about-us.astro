---
import { getEntry } from "astro:content";
import PageLayout from "~/layouts/PageLayout.astro";
import Hero from "~/components/widgets/Hero.astro";
import ContentWithImage from "~/components/widgets/ContentWithImage.astro";
import FeaturesSection from "~/components/widgets/FeaturesSection.astro";
import FeaturesWithImage from "~/components/widgets/FeaturesWithImage.astro";
import CTALight from "~/components/widgets/CTALight.astro";
import { getPageTitle } from "~/utils/config";

// Get about-us content from MDX
const aboutContent = await getEntry("pages", "about-us");
const { sections } = aboutContent.data;

// Sort sections by order
const sortedSections = sections.sort(
  (a: any, b: any) => (a.order || 0) - (b.order || 0)
);

const metadata = {
  title:
    aboutContent.data.metadata?.title || getPageTitle(aboutContent.data.title),
  description:
    aboutContent.data.metadata?.description || aboutContent.data.description,
};
---

<PageLayout metadata={metadata}>
  {
    sortedSections.map((section: any) => {
      // Hero Section
      if (section.section === "Hero") {
        return (
          <Hero
            tagline={section.eyebrow}
            title={section.title}
            subtitle={section.description}
            image={section.image}
            actions={
              section.ctaText && section.ctaLink
                ? [
                    {
                      text: section.ctaText,
                      href: section.ctaLink,
                      variant: "primary",
                    },
                  ]
                : []
            }
          />
        );
      }

      // ContentWithImage Section
      if (section.section === "ContentWithImage") {
        return (
          <ContentWithImage
            title={section.title}
            eyebrow={section.eyebrow}
            description={section.description}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
            image={section.image}
            imagePosition={section.imagePosition}
            background={section.background}
          />
        );
      }

      // FeaturesSection
      if (section.section === "FeaturesSection" && section.features) {
        return (
          <FeaturesSection
            eyebrow={section.eyebrow}
            title={section.title}
            description={section.description}
            features={section.features}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
          />
        );
      }

      // FeaturesWithImage Section
      if (section.section === "FeaturesWithImage" && section.features) {
        return (
          <FeaturesWithImage
            eyebrow={section.eyebrow}
            title={section.title}
            description={section.description}
            cards={section.features}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
            isCarousel={section.isCarousel}
            itemsPerSlide={section.itemsPerSlide}
            carouselAutoplay={section.carouselAutoplay}
            carouselAutoplayDelay={section.carouselAutoplayDelay}
          />
        );
      }

      // CTALight Section
      if (section.section === "CTALight") {
        return (
          <CTALight
            title={section.title}
            description={section.description}
            ctaText={section.ctaText || "Get in Touch"}
            ctaLink={section.ctaLink || "/contact-us"}
          />
        );
      }

      return null;
    })
  }
</PageLayout>
