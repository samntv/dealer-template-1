---
import { getEntry } from "astro:content";
import PageLayout from "~/layouts/PageLayout.astro";
import Hero from "~/components/widgets/Hero.astro";
import ServicesGrid from "~/components/widgets/ServicesGrid.astro";
import VenueNetwork from "~/components/widgets/VenueNetwork.astro";
import BoostVisibility from "~/components/widgets/BoostVisibility.astro";
import CallToAction from "~/components/widgets/CallToAction.astro";
import FAQs from "~/components/widgets/FAQs.astro";

// Get homepage content from MDX
const homeContent = await getEntry("pages", "home");
const { sections } = homeContent.data;

// Helper to find section by name
const getSection = (name: string) => sections.find((s) => s.section === name);

const heroSection = getSection("Hero");
const servicesGridSection = getSection("ServicesGrid");
const venueNetworkSection = getSection("VenueNetwork");
const boostVisibilitySection = getSection("BoostVisibility");
const ctaBannerSection = getSection("CTABanner");
const faqsSection = getSection("FAQs");
const finalCTASection = getSection("FinalCTA");
---

<PageLayout metadata={homeContent.data.metadata}>
  {
    heroSection && (
      <Hero
        tagline={heroSection.eyebrow}
        title={heroSection.title}
        subtitle={heroSection.description}
        image={heroSection.image}
        actions={[
          {
            text: heroSection.ctaText || "Get Started",
            href: heroSection.ctaLink || "/contact",
            variant: "primary",
          },
        ]}
      />
    )
  }

  {
    servicesGridSection && servicesGridSection.cards && (
      <ServicesGrid
        title={servicesGridSection.title}
        description={servicesGridSection.description}
        ctaText={servicesGridSection.ctaText}
        ctaLink={servicesGridSection.ctaLink}
        cards={servicesGridSection.cards}
      />
    )
  }

  {
    venueNetworkSection && (
      <VenueNetwork
        title={venueNetworkSection.title}
        eyebrow={venueNetworkSection.eyebrow}
        description={venueNetworkSection.description}
        ctaText={venueNetworkSection.ctaText}
        ctaLink={venueNetworkSection.ctaLink}
        image={venueNetworkSection.image}
        keyPoints={venueNetworkSection.keyPoints}
      />
    )
  }

  {
    boostVisibilitySection && boostVisibilitySection.features && (
      <BoostVisibility
        title={boostVisibilitySection.title}
        description={boostVisibilitySection.description}
        image={boostVisibilitySection.image}
        ctaText={boostVisibilitySection.ctaText}
        ctaLink={boostVisibilitySection.ctaLink}
        features={boostVisibilitySection.features}
      />
    )
  }

  {
    ctaBannerSection && (
      <CallToAction
        title={ctaBannerSection.title}
        subtitle={ctaBannerSection.description}
        actions={[
          {
            text: ctaBannerSection.ctaText || "Get Started",
            href: ctaBannerSection.ctaLink || "/contact",
            variant: "primary",
          },
        ]}
      />
    )
  }

  {
    faqsSection && faqsSection.faqs && (
      <FAQs title={faqsSection.title} faqs={faqsSection.faqs} />
    )
  }

  {
    finalCTASection && (
      <CallToAction
        title={finalCTASection.title}
        subtitle={finalCTASection.description}
        actions={[
          {
            text: finalCTASection.ctaText || "Get Started",
            href: finalCTASection.ctaLink || "/contact",
            variant: "primary",
          },
        ]}
      />
    )
  }
</PageLayout>
