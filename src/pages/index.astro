---
import { getEntry } from "astro:content";
import PageLayout from "~/layouts/PageLayout.astro";
import Hero from "~/components/widgets/Hero.astro";
import ServicesGrid from "~/components/widgets/ServicesGrid.astro";
import ContentWithKeypoints from "~/components/widgets/ContentWithKeypoints.astro";
import BoostVisibility from "~/components/widgets/BoostVisibility.astro";
import CallToAction from "~/components/widgets/CallToAction.astro";
import FAQs from "~/components/widgets/FAQs.astro";
import MapSection from "~/components/widgets/MapSection.astro";

// Get homepage content from MDX
const homeContent = await getEntry("pages", "home");
const { sections } = homeContent.data;

// Helper to find section by name
const getSection = (name: string) => sections.find((s) => s.section === name);
// Helper to find section by name and order
const getSectionByOrder = (name: string, order: number) => 
  sections.find((s) => s.section === name && s.order === order);

const heroSection = getSection("Hero");
const servicesGridSection = getSection("ServicesGrid");
const venueNetworkSection = getSectionByOrder("ContentWithKeypoints", 3);
const boostVisibilitySection = getSection("BoostVisibility");
const whyChooseUsSection = getSectionByOrder("ContentWithKeypoints", 5);
const ctaBannerSection = getSection("CTABanner");
const faqsSection = getSection("FAQs");
const mapSection = getSection("Map");
const finalCTASection = getSection("FinalCTA");
---

<PageLayout metadata={homeContent.data.metadata}>
  {
    heroSection && (
      <Hero
        tagline={heroSection.eyebrow}
        title={heroSection.title}
        subtitle={heroSection.description}
        image={heroSection.image}
        actions={[
          {
            text: heroSection.ctaText || "Get Started",
            href: heroSection.ctaLink || "/contact",
            variant: "primary",
          },
        ]}
      />
    )
  }

  {
    servicesGridSection && servicesGridSection.cards && (
      <ServicesGrid
        title={servicesGridSection.title}
        description={servicesGridSection.description}
        ctaText={servicesGridSection.ctaText}
        ctaLink={servicesGridSection.ctaLink}
        cards={servicesGridSection.cards}
      />
    )
  }

  {
    venueNetworkSection && (
      <ContentWithKeypoints
        title={venueNetworkSection.title}
        description={venueNetworkSection.description}
        ctaText={venueNetworkSection.ctaText}
        ctaLink={venueNetworkSection.ctaLink}
        keyPoints={venueNetworkSection.keyPoints}
        image={venueNetworkSection.image}
      />
    )
  }

  {
    boostVisibilitySection && boostVisibilitySection.features && (
      <BoostVisibility
        title={boostVisibilitySection.title}
        description={boostVisibilitySection.description}
        image={boostVisibilitySection.image}
        ctaText={boostVisibilitySection.ctaText}
        ctaLink={boostVisibilitySection.ctaLink}
        features={boostVisibilitySection.features}
      />
    )
  }

  {
    whyChooseUsSection && (
      <ContentWithKeypoints
        title={whyChooseUsSection.title}
        description={whyChooseUsSection.description}
        ctaText={whyChooseUsSection.ctaText}
        ctaLink={whyChooseUsSection.ctaLink}
        keyPoints={whyChooseUsSection.keyPoints}
        image={whyChooseUsSection.image}
      />
    )
  }

  {
    ctaBannerSection && (
      <CallToAction
        title={ctaBannerSection.title}
        subtitle={ctaBannerSection.description}
        actions={[
          {
            text: ctaBannerSection.ctaText || "Get Started",
            href: ctaBannerSection.ctaLink || "/contact",
            variant: "primary",
          },
        ]}
      />
    )
  }

  {
    faqsSection && faqsSection.faqs && (
      <FAQs title={faqsSection.title} faqs={faqsSection.faqs} />
    )
  }

  {
    mapSection && (
      <MapSection
        title={mapSection.title}
        description={mapSection.description}
        locations={mapSection.locations}
      />
    )
  }

  {
    finalCTASection && (
      <CallToAction
        title={finalCTASection.title}
        subtitle={finalCTASection.description}
        actions={[
          {
            text: finalCTASection.ctaText || "Get Started",
            href: finalCTASection.ctaLink || "/contact",
            variant: "primary",
          },
        ]}
      />
    )
  }
</PageLayout>
