---
import { getCollection, type CollectionEntry } from "astro:content";
import PageLayout from "~/layouts/PageLayout.astro";
import CallToAction from "~/components/widgets/CallToAction.astro";
import Hero from "~/components/widgets/Hero.astro";
import FAQs from "~/components/widgets/FAQs.astro";
import ContentWithImage from "~/components/widgets/ContentWithImage.astro";
import ContentWithVideo from "~/components/widgets/ContentWithVideo.astro";
import CTALight from "~/components/widgets/CTALight.astro";
import FeaturesSection from "~/components/widgets/FeaturesSection.astro";
import FeaturesWithImage from "~/components/widgets/FeaturesWithImage.astro";
import NetworksSection from "~/components/widgets/NetworksSection.astro";
import FormSection from "~/components/widgets/FormSection.astro";
import { getPageTitle } from "~/utils/config";

export async function getStaticPaths() {
  const solutions = await getCollection("solutions");
  const brandingAwareness = solutions.filter(
    (s) => s.data.category === "branding-awareness"
  );
  return brandingAwareness.map((entry) => ({
    params: { slug: entry.slug.replace("branding-awareness/", "") },
    props: { entry },
  }));
}

type Props = {
  entry: CollectionEntry<"solutions">;
};

const { entry } = Astro.props;
const { Content } = await entry.render();

const sections = (entry.data.sections || []).sort(
  (a: any, b: any) => (a.order || 0) - (b.order || 0)
);

const metadata = {
  title: getPageTitle(entry.data.title),
  description: entry.data.description,
};
---

<PageLayout metadata={metadata}>
  {
    sections.map((section: any) => {
      // Hero Section
      if (section.section === "Hero") {
        return (
          <Hero
            tagline={section.eyebrow}
            title={section.title}
            subtitle={section.description}
            image={section.image}
            actions={
              section.ctaText && section.ctaLink
                ? [
                    {
                      text: section.ctaText,
                      href: section.ctaLink,
                      variant: "primary",
                    },
                  ]
                : []
            }
          />
        );
      }

      // FAQs Section
      if (section.section === "FAQs" && section.faqs) {
        return <FAQs title={section.title} faqs={section.faqs} />;
      }

      // ContentWithImage Section
      if (section.section === "ContentWithImage") {
        return (
          <ContentWithImage
            title={section.title}
            eyebrow={section.eyebrow}
            description={section.description}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
            image={section.image}
            imagePosition={section.imagePosition}
            background={section.background}
          />
        );
      }

      // ContentWithVideo Section
      if (section.section === "ContentWithVideo") {
        return (
          <ContentWithVideo
            title={section.title}
            eyebrow={section.eyebrow}
            description={section.description}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
            videoUrl={section.videoUrl}
            videoPosition={section.videoPosition}
            background={section.background}
            poster={section.poster}
            autoplay={section.autoplay}
            muted={section.muted}
            loop={section.loop}
            controls={section.controls}
          />
        );
      }

      // CTALight Section
      if (section.section === "CTALight") {
        return (
          <CTALight
            title={section.title}
            description={section.description}
            ctaText={section.ctaText || "Get in Touch"}
            ctaLink={section.ctaLink || "/contact"}
          />
        );
      }

      // Features Sections
      if (
        section.section === "FeaturesWithImage" ||
        section.section === "FeaturesSection"
      ) {
        if (!section.features) return null;

        if (section.section === "FeaturesWithImage") {
          return (
            <FeaturesWithImage
              eyebrow={section.eyebrow}
              title={section.title}
              description={section.description}
              cards={section.features}
              ctaText={section.ctaText}
              ctaLink={section.ctaLink}
              isCarousel={section.isCarousel}
              itemsPerSlide={section.itemsPerSlide}
              carouselAutoplay={section.carouselAutoplay}
              carouselAutoplayDelay={section.carouselAutoplayDelay}
            />
          );
        }

        return (
          <FeaturesSection
            eyebrow={section.eyebrow}
            title={section.title}
            description={section.description}
            features={section.features}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
          />
        );
      }

      // Networks Section (for streaming platforms, etc.)
      if (section.section === "Networks" && section.networks) {
        return (
          <NetworksSection
            title={section.title}
            subtitle={section.subtitle}
            description={section.description}
            networks={section.networks}
          />
        );
      }

      // Form Section
      if (section.section === "Form" && section.formFields) {
        return (
          <FormSection
            title={section.title}
            subtitle={section.eyebrow}
            description={section.description}
            fields={section.formFields}
            submitText={section.submitText}
            submitAction={section.submitAction}
            background={section.background}
          />
        );
      }

      return null;
    })
  }

  <CallToAction
    title={entry.data.ctaText ? undefined : "Ready to Get Started?"}
    subtitle={entry.data.ctaText
      ? undefined
      : "Contact us today to discuss your project and see how we can help your business grow."}
    actions={[
      {
        text: entry.data.ctaText || "Get in Touch",
        href: entry.data.ctaLink || "/contact",
        variant: "primary",
      },
    ]}
  />
</PageLayout>
