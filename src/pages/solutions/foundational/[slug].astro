---
import { getCollection, type CollectionEntry } from "astro:content";
import PageLayout from "~/layouts/PageLayout.astro";
import CallToAction from "~/components/widgets/CallToAction.astro";
import Hero from "~/components/widgets/Hero.astro";
import FAQs from "~/components/widgets/FAQs.astro";
import MapSection from "~/components/widgets/MapSection.astro";
import ContentWithKeypoints from "~/components/widgets/ContentWithKeypoints.astro";
import ContentWithImage from "~/components/widgets/ContentWithImage.astro";
import BoostVisibility from "~/components/widgets/BoostVisibility.astro";
import CTALight from "~/components/widgets/CTALight.astro";
import FeaturesSection from "~/components/widgets/FeaturesSection.astro";
import FeaturesWithImage from "~/components/widgets/FeaturesWithImage.astro";
import DesignSkillsGrid from "~/components/widgets/DesignSkillsGrid.astro";
import { getPageTitle } from "~/utils/config";

export async function getStaticPaths() {
  const solutions = await getCollection("solutions");
  const foundational = solutions.filter(
    (s) => s.data.category === "foundational"
  );

  return foundational.map((entry) => ({
    params: { slug: entry.slug.replace("foundational/", "") },
    props: { entry },
  }));
}

type Props = {
  entry: CollectionEntry<"solutions">;
};

const { entry } = Astro.props;
const { Content } = await entry.render();

const sections = (entry.data.sections || []).sort((a: any, b: any) => (a.order || 0) - (b.order || 0));

const metadata = {
  title: getPageTitle(entry.data.title),
  description: entry.data.description,
};
---

<PageLayout metadata={metadata}>
  {
    sections.map((section: any) => {
      // Hero Section
      if (section.section === "Hero") {
        return (
          <Hero
            tagline={section.eyebrow}
            title={section.title}
            subtitle={section.description}
            image={section.image}
            actions={
              section.ctaText && section.ctaLink
                ? [
                    {
                      text: section.ctaText,
                      href: section.ctaLink,
                      variant: "primary",
                    },
                  ]
                : []
            }
          />
        );
      }

      // FAQs Section
      if (section.section === "FAQs" && section.faqs) {
        return <FAQs title={section.title} faqs={section.faqs} />;
      }

      // Map Section
      if (section.section === "Map" && section.locations) {
        return (
          <MapSection
            title={section.title}
            description={section.description}
            locations={section.locations}
          />
        );
      }

      // ContentWithKeypoints Section (two-column with image and key points)
      if (section.section === "ContentWithKeypoints") {
        return (
          <ContentWithKeypoints
            title={section.title}
            eyebrow={section.eyebrow}
            description={section.description}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
            image={section.image}
            keyPoints={section.keyPoints}
          />
        );
      }

      // CustomWebsites Section (content with image layout)
      if (section.section === "ContentWithImage") {
        return (
          <ContentWithImage
            title={section.title}
            eyebrow={section.eyebrow}
            description={section.description}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
            image={section.image}
            imagePosition={section.imagePosition}
            background={section.background}
          />
        );
      }

      // BoostVisibility Section (image + features grid)
      if (section.section === "BoostVisibility") {
        return (
          <BoostVisibility
            title={section.title}
            description={section.description}
            image={section.image}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
            features={section.features || []}
          />
        );
      }

      // WhyChooseUs / Overview / Cornerstone Sections (centered text with key points)
      if (
        section.section === "CTALight"
      ) {
        return (
          <CTALight
            title={section.title}
            description={section.description}
            ctaText={section.ctaText || "Get In Touch"}
            ctaLink={section.ctaLink || "/contact"}
          />
        );
      }

      // Design Skills Grid Section
      if (section.section === "DesignSkillsGrid" && section.skills) {
        return (
          <DesignSkillsGrid
            title={section.title}
            description={section.description}
            skills={section.skills}
          />
        );
      }

      // Features Sections (DesignProcess, ServiceApproach, TwoColumnFeatures)
      if (
        section.section === "FeaturesWithImage" ||
        section.section === "FeaturesSection"
      ) {
        if (!section.features) return null;
        // Use ImageCards for DesignProcess (has images)
        if (section.section === "FeaturesWithImage") {
          return (
            <FeaturesWithImage
              eyebrow={section.eyebrow}
              title={section.title}
              description={section.description}
              cards={section.features}
              ctaText={section.ctaText}
              ctaLink={section.ctaLink}
            />
          );
        }
        // Use FeaturesSection for others (no images)
        return (
          <FeaturesSection
            eyebrow={section.eyebrow}
            title={section.title}
            description={section.description}
            features={section.features}
            ctaText={section.ctaText}
            ctaLink={section.ctaLink}
          />
        );
      }

      return null;
    })
  }

  <CallToAction
    title={entry.data.ctaText ? undefined : "Ready to Get Started?"}
    subtitle={entry.data.ctaText
      ? undefined
      : "Contact us today to discuss your project and see how we can help your business grow."}
    actions={[
      {
        text: entry.data.ctaText || "Get In Touch",
        href: entry.data.ctaLink || "/contact",
        variant: "primary",
      },
    ]}
  />
</PageLayout>
